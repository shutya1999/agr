const CLASS_NAME_SELECT="select",CLASS_NAME_ACTIVE="select_show",CLASS_NAME_SELECTED="select__option_selected",SELECTOR_ACTIVE=".select_show",SELECTOR_DATA="[data-select]",SELECTOR_DATA_TOGGLE='[data-select="toggle"]',SELECTOR_OPTION_SELECTED=".select__option_selected";class CustomSelect{constructor(e,t){this._elRoot="string"==typeof e?document.querySelector(e):e,this._params=t||{},this._params.options&&(this._elRoot.classList.add("select"),this._elRoot.innerHTML=CustomSelect.template(this._params)),this._elToggle=this._elRoot.querySelector(SELECTOR_DATA_TOGGLE),this._elHidden=this._elRoot.querySelector("input[type=hidden]"),this._elRoot.addEventListener("click",this._onClick.bind(this)),this._params.search&&this._oninput(this._elRoot,this._params)}_onClick(e){const t=e.target;switch(t.closest(SELECTOR_DATA).dataset.select){case"toggle":this.toggle();break;case"option":this._changeValue(t)}}_update(e){e=e.closest(".select__option");const t=this._elRoot.querySelector(SELECTOR_OPTION_SELECTED);return t&&t.classList.remove(CLASS_NAME_SELECTED),e.classList.add(CLASS_NAME_SELECTED),"search"===this._elToggle.dataset.type?(this._elToggle.value=e.textContent,this._elHidden.value=e.dataset.value):(this._elToggle.textContent=e.textContent,this._elToggle.value=e.dataset.value,this._elRoot.classList.add("_selected")),this._elToggle.dataset.index=e.dataset.index,this._elRoot.dispatchEvent(new CustomEvent("select.change")),this._params.onSelected&&this._params.onSelected(this,e),e.dataset.value}_reset(){const e=this._elRoot.querySelector(SELECTOR_OPTION_SELECTED);return e&&e.classList.remove(CLASS_NAME_SELECTED),this._elToggle.textContent="Выберите из списка",this._elToggle.value="",this._elToggle.dataset.index=-1,this._elRoot.dispatchEvent(new CustomEvent("select.change")),this._params.onSelected&&this._params.onSelected(this,null),""}_changeValue(e){e.classList.contains(CLASS_NAME_SELECTED)||(this._update(e),this.hide())}_oninput(e,t){this._elToggle.addEventListener("input",(()=>{let e=this._elToggle.value.trim(),s=[];if(""!==e)t.options.forEach(((t,l)=>{let o="_hide",a=t[1];-1!==a.search(e)&&(o="",a=this._insertMark(a,a.search(e),e.length)),s.push(`<li class="select__option ${o}" data-select="option" data-value="${t[0]}" data-index="${l}">${a}</li>`)})),this._elRoot.querySelector(".select__options").innerHTML=s.join("");else{let e=[];t.options.forEach(((t,s)=>{e.push(`<li class="select__option" data-select="option" data-value="${t[0]}" data-index="${s}">${t[1]}</li>`)})),this._elRoot.querySelector(".select__options").innerHTML=e.join("")}}))}_insertMark(e,t,s){return e.slice(0,t)+"<mark>"+e.slice(t,t+s)+"</mark>"+e.slice(t+s)}show(){document.querySelectorAll(".select_show").forEach((e=>{e.classList.remove("select_show")})),this._elRoot.classList.add("select_show")}hide(){this._elRoot.classList.remove("select_show")}toggle(){this._elRoot.classList.contains("select_show")?this.hide():this.show()}dispose(){this._elRoot.removeEventListener("click",this._onClick)}get value(){return this._elToggle.value}set value(e){let t=!1;if(this._elRoot.querySelectorAll(".select__option").forEach((s=>{if(s.dataset.value===e)return t=!0,this._update(s)})),!t)return this._reset()}get selectedIndex(){return this._elToggle.dataset.index}set selectedIndex(e){const t=this._elRoot.querySelector(`.select__option[data-index="${e}"]`);return t?this._update(t):this._reset()}}CustomSelect.template=e=>{const t=e.name,s=e.options,l=e.targetValue;let o,a=[],i=-1,n="",c="Выберите из списка",_=void 0!==e.placeholder?e.placeholder:"Оберіть із списку або введіть";if(s.forEach(((e,t)=>{let s="";e[0]===l&&(s=" select__option_selected",i=t,n=e[0],c=e[1]),a.push(`<li class="select__option${s}" data-select="option" data-value="${e[0]}" data-index="${t}">${e[1]}</li>`)})),e.search){let e=`<input type="text" class="select__input" placeholder="${_}" value="${c}" data-select="toggle" data-type="search" data-index="${i}">`;""===n&&(e=`<input type="text" placeholder="${_}" class="select__input" data-select="toggle" data-type="search" data-index="${i}">`),o=`\n            <div class="select__toggle">\n                ${e}\n                <input type="hidden" value="${n}" name="${t}">\n            </div>\n        `}else o=`\n            <div class="select__toggle">       \n                <label>Тест</label>        \n                <button type="button" name="${t}" value="${n}" data-type="button" data-select="toggle" data-index="${i}">${c}</button>\n            </div>\n        `;return`\n        ${o}\n        <div class="select__dropdown">\n            <ul class="select__options">${a.join("")}</ul>\n        </div>\n    `},document.addEventListener("click",(e=>{e.target.closest(".select")||document.querySelectorAll(".select_show").forEach((e=>{e.classList.remove("select_show")}))}));